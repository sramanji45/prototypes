datadir="/var/lib/proxysql"

admin_variables=
{
    admin_credentials="admin:admin;radmin:radmin"
    mysql_ifaces="0.0.0.0:6032"
}

mysql_variables=
{
    threads=4
    max_connections=2048
    default_query_delay=0
    default_query_timeout=36000000
    have_compress=true
    poll_timeout=2000
    interfaces="0.0.0.0:6033" # This is where App connects
    default_schema="information_schema"
    stacksize=1048576
    connect_timeout_server=10000
    monitor_username="replica_user" # ProxySQL uses this to 'ping' health
    monitor_password="password123"
}

# Define your backend servers
mysql_servers =
(
    { address="mysql-shard1", port=3306, hostgroup=101, max_connections=200 },
    { address="mysql-shard2", port=3306, hostgroup=102, max_connections=200 },
    { address="mysql-shard3", port=3306, hostgroup=103, max_connections=200 }
)

mysql_users:
(
    { username = "root", password = "root123", default_hostgroup = 101, transaction_persistent = 1, active = 1 }
)

# Define the "Range partitioning Rules"
mysql_query_rules:
(
    # Route names starting with A-I to Shard 1
    {
        rule_id=1
        active=1
        match_pattern="VALUES \('[A-Ia-i].*'"
        destination_hostgroup=101
        apply=1
    },
    # Route names starting with J-S to Shard 2
    {
        rule_id=2
        active=1
        match_pattern="VALUES \('[J-Sj-s].*'"
        destination_hostgroup=102
        apply=1
    },
    # Route names starting with T-Z to Shard 3
    {
        rule_id=3
        active=1
        match_pattern="VALUES \('[T-Zt-z].*'"
        destination_hostgroup=103
        apply=1
    }
)